(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{153:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"rightToc",(function(){return b})),t.d(n,"default",(function(){return u}));var r=t(2),a=t(9),c=(t(0),t(215)),i={id:"sql-test-and-data-check",title:"\u5206\u6790 SQL \u306e\u30c6\u30b9\u30c8\u3068\u30c7\u30fc\u30bf\u30c1\u30a7\u30c3\u30af\u30b9\u30bf\u30a4\u30eb\u306e\u63d0\u6848",author:"Naofumi Yamada",author_title:"Data Engineer",author_url:"https://github.com/na0fu3y",author_image_url:"https://avatars0.githubusercontent.com/u/17900178?s=400&v=4",tags:["bigquery"]},l={permalink:"/blog/sql-test-and-data-check",editUrl:"https://github.com/na0fu3y/queuery/edit/master/blog/2020-01-21-sql-test-and-data-check.md",source:"@site/blog/2020-01-21-sql-test-and-data-check.md",description:"\u3053\u306e\u8a18\u4e8b\u306f bqsushi \u3067\u767a\u8868\u3057\u305f BigQuery \u30c7\u30fc\u30bf\u524d\u51e6\u7406\u306e\u6697\u9ed2\u9762 \u306e\u500b\u4eba\u7684\u306a\u89e3\u8aac\u3067\u3059\u3002",date:"2020-01-21T00:00:00.000Z",tags:[{label:"bigquery",permalink:"/blog/tags/bigquery"}],title:"\u5206\u6790 SQL \u306e\u30c6\u30b9\u30c8\u3068\u30c7\u30fc\u30bf\u30c1\u30a7\u30c3\u30af\u30b9\u30bf\u30a4\u30eb\u306e\u63d0\u6848",readingTime:4.51,truncated:!0,prevItem:{title:"BigQuery \u60c5\u5831\u53ce\u96c6",permalink:"/blog/new-bigquery"}},b=[{value:"\u610f\u5473\u306e\u3042\u308b\u5358\u4f4d\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u3092 FUNCTION \u304b WITH \u53e5\u306b\u5206\u96e2\u3059\u308b\u3002",id:"\u610f\u5473\u306e\u3042\u308b\u5358\u4f4d\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u3092-function-\u304b-with-\u53e5\u306b\u5206\u96e2\u3059\u308b\u3002",children:[{value:"birth_date_percentile_5",id:"birth_date_percentile_5",children:[]},{value:"user_master",id:"user_master",children:[]},{value:"pos",id:"pos",children:[]},{value:"rfm_feature",id:"rfm_feature",children:[]},{value:"concatinated_features",id:"concatinated_features",children:[]}]},{value:"\u53ef\u5909\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u53c2\u7167\u3092\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u53c2\u7167\u306b\u7f6e\u304d\u63db\u3048\u3001SQL \u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002",id:"\u53ef\u5909\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u53c2\u7167\u3092\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u53c2\u7167\u306b\u7f6e\u304d\u63db\u3048\u3001sql-\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002",children:[{value:"birth_date_percentile_5",id:"birth_date_percentile_5-1",children:[]},{value:"user_master",id:"user_master-1",children:[]},{value:"pos",id:"pos-1",children:[]},{value:"rfm_feature",id:"rfm_feature-1",children:[]},{value:"concatinated_features",id:"concatinated_features-1",children:[]}]},{value:"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002",id:"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002",children:[{value:"dirty_user_master",id:"dirty_user_master",children:[]},{value:"user_master",id:"user_master-3",children:[]},{value:"dirty_pos",id:"dirty_pos",children:[]},{value:"dirty_pos",id:"dirty_pos-1",children:[]}]},{value:"rfm_feature",id:"rfm_feature-2",children:[]},{value:"SQL \u30d5\u30a1\u30a4\u30eb\u306b\u3001\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092 FUNCTION \u304b WITH \u53e5\u3068\u3057\u3066\u7d50\u5408\u3059\u308b\u3002",id:"sql-\u30d5\u30a1\u30a4\u30eb\u306b\u3001\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092-function-\u304b-with-\u53e5\u3068\u3057\u3066\u7d50\u5408\u3059\u308b\u3002",children:[]},{value:"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u529b\u6642\u306b\u3001\u30c6\u30b9\u30c8\u7528\u51fa\u529b\u304c\u8fd4\u3063\u3066\u304f\u308b\u304b\u30c6\u30fc\u30d6\u30eb\u3092\u6bd4\u8f03\u3059\u308b\u3002",id:"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u529b\u6642\u306b\u3001\u30c6\u30b9\u30c8\u7528\u51fa\u529b\u304c\u8fd4\u3063\u3066\u304f\u308b\u304b\u30c6\u30fc\u30d6\u30eb\u3092\u6bd4\u8f03\u3059\u308b\u3002",children:[]},{value:"\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5236\u7d04",id:"\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5236\u7d04",children:[{value:"CHECK",id:"check",children:[]},{value:"NOT NULL",id:"not-null",children:[]},{value:"UNIQUE",id:"unique",children:[]},{value:"FOREIGN KEY",id:"foreign-key",children:[]}]},{value:"\u8981\u7d04\u7d71\u8a08\u91cf\u306e\u6bd4\u8f03",id:"\u8981\u7d04\u7d71\u8a08\u91cf\u306e\u6bd4\u8f03",children:[{value:"Tensorflow Data Validation",id:"tensorflow-data-validation",children:[]},{value:"pandas-profiling",id:"pandas-profiling",children:[]},{value:"bq_profile",id:"bq_profile",children:[]}]}],d={rightToc:b};function u(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("p",null,"\u3053\u306e\u8a18\u4e8b\u306f bq_sushi \u3067\u767a\u8868\u3057\u305f ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.google.com/presentation/d/e/2PACX-1vQa0h1sf1UQLOR8Owj00fkDaG_QberK-8M-4RYAFF8IBC8JYyDlADETxCfza7aynVzm9L3-9TkCz-_r/pub?slide=id.g7b4fd3bc26_0_0"}),"BigQuery \u30c7\u30fc\u30bf\u524d\u51e6\u7406\u306e\u6697\u9ed2\u9762")," \u306e\u500b\u4eba\u7684\u306a\u89e3\u8aac\u3067\u3059\u3002"),Object(c.b)("h1",{id:"\u306f\u3058\u3081\u306b"},"\u306f\u3058\u3081\u306b"),Object(c.b)("p",null,"\u5f93\u6765\u306e\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306e\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff08Oracle \u3084 SQL Server\u3001MySQL \u306a\u3069\uff09\u3067\u306f\u3001\u306a\u308b\u3079\u304f\u51e6\u7406\u3092\u5c11\u306a\u304f\u3059\u308b\u305f\u3081\u3001\u30c7\u30fc\u30bf\u4e2d\u5fc3\u306e\u6bd4\u8f03\u7684\u77ed\u3044 SQL \u3092\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001BigQuery \u3067\u306f\u30b3\u30b9\u30d1\u826f\u304f\u30c7\u30fc\u30bf\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001\u624b\u7d9a\u304d\u4e2d\u5fc3\u306e\u6bd4\u8f03\u7684\u9577\u3044 SQL \u3092\u8a18\u8ff0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"),Object(c.b)("p",null,"\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u898f\u7d04\uff08",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://qiita.com/piyoSakai/items/e1b97366ca5940dad517"}),"Bigquery\u6642\u4ee3\u306b\u304a\u3051\u308b\u3001\u5206\u6790SQL\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u30b9\u30bf\u30a4\u30eb\u306e\u63d0\u5531")," \u3084 ",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://techlife.cookpad.com/entry/2016/11/09/000033"}),"\u5206\u6790SQL\u306e\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u30b9\u30bf\u30a4\u30eb"),"\uff09\u306e\u8b70\u8ad6\u306f\u3042\u308a\u307e\u3059\u304c\u3001SQL \u306e\u7d99\u7d9a\u7684\u306a\u958b\u767a\u8ad6\u306f\u78ba\u7acb\u3057\u3066\u3044\u306a\u3055\u305d\u3046\u3067\u3059\u3002"),Object(c.b)("p",null,"\u672c\u7a3f\u3067\u306f\u3001",Object(c.b)("strong",{parentName:"p"},"SQL \u3092\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u306b\u4e57\u305b\u3001\u7d99\u7d9a\u7684\u306a\u958b\u767a\u904b\u7528\u3092\u884c\u3046")," \u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3001\u5206\u6790 SQL \u306e\u30c6\u30b9\u30c8\u624b\u6cd5\u3068\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u540c\u5b9a\u6cd5\u306b\u3064\u3044\u3066\u8ff0\u3079\u307e\u3059\u3002"),Object(c.b)("h1",{id:"\u5206\u6790-sql-\u306e\u30c6\u30b9\u30c8\u624b\u6cd5"},"\u5206\u6790 SQL \u306e\u30c6\u30b9\u30c8\u624b\u6cd5"),Object(c.b)("p",null,"\u5206\u6790 SQL \u3092\u30c6\u30b9\u30c8\u53ef\u80fd\u306b\u3059\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u5de5\u7a0b\u3092\u8e0f\u307f\u307e\u3059\u3002"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"\u610f\u5473\u306e\u3042\u308b\u5358\u4f4d\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u3092 FUNCTION \u304b WITH \u53e5\u306b\u5206\u96e2\u3059\u308b\u3002"),Object(c.b)("li",{parentName:"ol"},"\u53ef\u5909\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u53c2\u7167\u3092\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u53c2\u7167\u306b\u7f6e\u304d\u63db\u3048\u3001SQL \u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002"),Object(c.b)("li",{parentName:"ol"},"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002"),Object(c.b)("li",{parentName:"ol"},"SQL \u30d5\u30a1\u30a4\u30eb\u306b\u3001\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092 FUNCTION \u304b WITH \u53e5\u3068\u3057\u3066\u7d50\u5408\u3059\u308b\u3002"),Object(c.b)("li",{parentName:"ol"},"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u529b\u6642\u306b\u3001\u30c6\u30b9\u30c8\u7528\u51fa\u529b\u304c\u8fd4\u3063\u3066\u304f\u308b\u304b\u30c6\u30fc\u30d6\u30eb\u3092\u6bd4\u8f03\u3059\u308b\u3002")),Object(c.b)("h2",{id:"\u610f\u5473\u306e\u3042\u308b\u5358\u4f4d\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u3092-function-\u304b-with-\u53e5\u306b\u5206\u96e2\u3059\u308b\u3002"},"\u610f\u5473\u306e\u3042\u308b\u5358\u4f4d\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u3092 FUNCTION \u304b WITH \u53e5\u306b\u5206\u96e2\u3059\u308b\u3002"),Object(c.b)("p",null,"\u4ee5\u4e0b\u306e\u30af\u30a8\u30ea\u3092\u4f8b\u306b\u59cb\u3081\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u307e\u305a\u306f\u610f\u5473\u5358\u4f4d\u306b\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"  -- \u8a95\u751f\u65e5\u306e 5% \u70b9\u3092\u898b\u3064\u3051\u308b\u95a2\u6570\n  -- \u5916\u308c\u5024\u306e\u9664\u53bb\u306b\u5229\u7528\u3059\u308b\nCREATE TEMP FUNCTION\n  birth_date_percentile_5()AS((\n    SELECT\n      APPROX_QUANTILES(birth_date,100)[\n    OFFSET\n      (5)]\n    FROM\n      mydataset.dirty_user_master));\n\nWITH\n  -- \u30e6\u30fc\u30b6\u60c5\u5831\u3092\u304d\u308c\u3044\u306b\u3057\u305f\u30c6\u30fc\u30d6\u30eb\n  -- user_id: \u30e6\u30fc\u30b6\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u4e3b\u30ad\u30fc\u3002\n  -- gender: \u6027\u5225\u3001'\u7537' \u304b '\u5973' \u304b NULL \u3092\u6301\u3064\u3002\n  -- birth_date: 5% \u70b9\u3068 18 \u6b73\u4ee5\u4e0a\u3067\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u3057\u305f\u8a95\u751f\u65e5\u3002\n  -- zip_code: \u30cf\u30a4\u30d5\u30f3\u306a\u3057 7 \u6841\u306e\u90f5\u4fbf\u756a\u53f7\u3002\n  `user_master`AS(\n  SELECT\n    user_id,\n    ANY_VALUE(CASE gender\n        WHEN 1 THEN '\u7537'\n        WHEN 2 THEN '\u5973'\n      ELSE\n      NULL\n    END\n      ) gender,\n    ANY_VALUE(\n    IF\n      (birth_date_percentile_5()<=birth_date\n        AND birth_date<DATE_SUB(CURRENT_DATE(),INTERVAL 18 YEAR),\n        birth_date,\n        NULL))birth_date,\n    ANY_VALUE(\n    IF\n      (REGEXP_CONTAINS(zip_code, \"^\\\\d{7}$\"),\n        zip_code,\n        NULL))zip_code\n  FROM\n    my_dataset.dirty_user_master\n  GROUP BY\n    user_id),\n\n  -- \u8cfc\u8cb7\u60c5\u5831\u3092\u304d\u308c\u3044\u306b\u3057\u305f\u30c6\u30fc\u30d6\u30eb\n  -- user_id: \u30e6\u30fc\u30b6\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u30ad\u30fc\u3002\n  -- datetime: \u53d6\u5f15\u65e5\u3002\n  -- amount: \u8cfc\u5165\u91d1\u984d\u3001\u8fd4\u54c1\u3067\u30de\u30a4\u30ca\u30b9\u306b\u306a\u308b\u306e\u3092\u9664\u53bb\u3057\u3066\u3042\u308b\u3002\n  -- item_id: \u5546\u54c1\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u30ad\u30fc\u3002\n  `pos`AS(\n  SELECT\n    DISTINCT user_id,\n    DATETIME(date,\n      time)datetime,\n    amount,\n    item_id\n  FROM\n    mydataset.dirty_pos\n  WHERE\n    amount>0),\n\n  -- pos \u304b\u3089 RFM \u5206\u6790\u3057\u305f\u7279\u5fb4\u91cf\u30c6\u30fc\u30d6\u30eb\n  -- user_id: \u30e6\u30fc\u30b6\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u30ad\u30fc\u3002\n  -- recency: \u6700\u65b0\u8cfc\u5165\u65e5\u3002\n  -- frequency: \u8cfc\u8cb7\u65e5\u6570\u3002\n  -- monetary: \u7dcf\u8cfc\u8cb7\u91d1\u984d\u3002\n  `rfm_feature`AS(\n  SELECT\n    user_id,\n    MAX(datetime)recency,\n    COUNT(DISTINCT DATE(datetime))frequency,\n    SUM(amount)monetary\n  FROM\n    pos\n  GROUP BY\n    user_id),\n\n-- \u6a5f\u68b0\u5b66\u7fd2\u306b\u6295\u5165\u3059\u308b\u30c7\u30fc\u30bf\n-- user_id: \u30e6\u30fc\u30b6\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u4e3b\u30ad\u30fc\u3002\n-- gender: \u6027\u5225\u3001'\u7537' \u304b '\u5973' \u304b NULL \u3092\u6301\u3064\u3002\n-- birth_date: 5% \u70b9\u3068 18 \u6b73\u4ee5\u4e0a\u3067\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u3057\u305f\u8a95\u751f\u65e5\u3002\n-- zip_code: \u30cf\u30a4\u30d5\u30f3\u306a\u3057 7 \u6841\u306e\u90f5\u4fbf\u756a\u53f7\u3002\n-- recency: \u6700\u65b0\u8cfc\u5165\u65e5\u3002\n-- frequency: \u8cfc\u8cb7\u65e5\u6570\u3002\n-- monetary: \u7dcf\u8cfc\u8cb7\u91d1\u984d\u3002\nSELECT\n  user_id,\n  gender,\n  birth_date,\n  zip_code,\n  recency,\n  frequency,\n  monetary\nFROM\n  user_master\nLEFT JOIN\n  rfm_feature\nUSING\n  (user_id)\n")),Object(c.b)("h3",{id:"birth_date_percentile_5"},"birth_date_percentile_5"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"(\n  SELECT\n    APPROX_QUANTILES(birth_date,100)[\n  OFFSET\n    (5)]\n  FROM\n    mydataset.dirty_user_master)\n")),Object(c.b)("h3",{id:"user_master"},"user_master"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  user_id,\n  ANY_VALUE(CASE gender\n      WHEN 1 THEN '\u7537'\n      WHEN 2 THEN '\u5973'\n    ELSE\n    NULL\n  END\n    ) gender,\n  ANY_VALUE(\n  IF\n    (birth_date_percentile_5()<=birth_date\n      AND birth_date<DATE_SUB(CURRENT_DATE(),INTERVAL 18 YEAR),\n      birth_date,\n      NULL))birth_date,\n  ANY_VALUE(\n  IF\n    (REGEXP_CONTAINS(zip_code, \"^\\\\d{7}$\"),\n      zip_code,\n      NULL))zip_code\nFROM\n  my_dataset.dirty_user_master\nGROUP BY\n  user_id\n")),Object(c.b)("h3",{id:"pos"},"pos"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  DISTINCT user_id,\n  DATETIME(date,\n    time)datetime,\n  amount,\n  item_id\nFROM\n  mydataset.dirty_pos\nWHERE\n  amount>0\n")),Object(c.b)("h3",{id:"rfm_feature"},"rfm_feature"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  user_id,\n  MAX(datetime)recency,\n  COUNT(DISTINCT DATE(datetime))frequency,\n  SUM(amount)monetary\nFROM\n  pos\nGROUP BY\n  user_id\n")),Object(c.b)("h3",{id:"concatinated_features"},"concatinated_features"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  user_id,\n  gender,\n  birth_date,\n  zip_code,\n  recency,\n  frequency,\n  monetary,\n  rfm_array\nFROM\n  user_master\nLEFT JOIN\n  rfm_feature\nUSING\n  (user_id)\nLEFT JOIN\n  rfm_feature_array\nUSING\n  (user_id)\n")),Object(c.b)("h2",{id:"\u53ef\u5909\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u53c2\u7167\u3092\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u53c2\u7167\u306b\u7f6e\u304d\u63db\u3048\u3001sql-\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002"},"\u53ef\u5909\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u53c2\u7167\u3092\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u53c2\u7167\u306b\u7f6e\u304d\u63db\u3048\u3001SQL \u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002"),Object(c.b)("p",null,"\u5206\u5272\u304c\u7d42\u308f\u3063\u305f\u3089\u3001FUNCTION \u4ee5\u5916\u306e\u3044\u304f\u3064\u304b\u6301\u3063\u3066\u3044\u308b\u53c2\u7167\u3092\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u53c2\u7167\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304f\u3053\u3068\u3067\u30c6\u30b9\u30c8\u306e\u6642\u306b\u306f\u3001WITH \u53e5\u3067\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u6295\u5165\u3001\u5b9f\u5229\u7528\u6642\u306f WITH \u53e5\u3067\u5b9f\u30c6\u30fc\u30d6\u30eb\u6295\u5165\u304c\u3067\u304d\u307e\u3059\u3002\n\u30c6\u30fc\u30d6\u30eb\u53c2\u7167\u3092\u6301\u3064 FUNCTION \u306b\u95a2\u3057\u3066\u306f\u53d6\u308a\u9664\u3051\u306a\u3044\uff08ARRAY_AGG \u3057\u3066\u5f15\u6570\u306b\u6e21\u305b\u3070\u5c0f\u3055\u3044\u30c6\u30fc\u30d6\u30eb\u306f\u6e21\u305b\u308b\u304c\u5927\u304d\u3044\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u5fdc\u3067\u304d\u306a\u3044\uff09\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u53c2\u7167\u900f\u904e\u6027\u3092\u4fdd\u8a3c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002"),Object(c.b)("h3",{id:"birth_date_percentile_5-1"},"birth_date_percentile_5"),Object(c.b)("p",null,"\u8ae6\u3081\u3066\u653e\u7f6e\u304b\u3001\u3053\u308c\u304f\u3089\u3044\u306a\u3089\u30af\u30a8\u30ea\u304c\u6b63\u3057\u3044\u3053\u3068\u3092\u30ec\u30d3\u30e5\u30fc\u306b\u3066\u901a\u3059\u3002\n\u4eca\u56de\u306f\u3001ARRAY_AGG \u3057\u305f\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u306b\u3057\u3066\u5bfe\u5fdc\u3059\u308b\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"(\n  SELECT\n    APPROX_QUANTILES(birth_date,100)[\n  OFFSET\n    (5)]\n  FROM\n    UNNEST(birth_dates)birth_date)\n")),Object(c.b)("h3",{id:"user_master-1"},"user_master"),Object(c.b)("p",null,"FROM \u53e5\u3092\u66f8\u304d\u63db\u3048\u3001CURRENT_DATE() \u306f\u518d\u73fe\u6027\u304c\u306a\u3044\u306e\u3067\u3001\u95a2\u6570\u3068\u3057\u3066\u5207\u308a\u51fa\u3057\u3066\u5b9a\u6570\u3092\u5165\u308c\u305f\u3002"),Object(c.b)("h4",{id:"my_current_date"},"MY_CURRENT_DATE"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"'2019-12-10'\n")),Object(c.b)("h4",{id:"user_master-2"},"user_master"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  user_id,\n  ANY_VALUE(CASE gender\n      WHEN 1 THEN '\u7537'\n      WHEN 2 THEN '\u5973'\n    ELSE\n    NULL\n  END\n    ) gender,\n  ANY_VALUE(\n  IF\n    (birth_date_percentile_5()<=birth_date\n      AND birth_date<DATE_SUB(MY_CURRENT_DATE(),INTERVAL 18 YEAR),\n      birth_date,\n      NULL))birth_date,\n  ANY_VALUE(\n  IF\n    (REGEXP_CONTAINS(zip_code, \"^\\\\d{7}$\"),\n      zip_code,\n      NULL))zip_code\nFROM\n  dirty_user_master\nGROUP BY\n  user_id\n")),Object(c.b)("h3",{id:"pos-1"},"pos"),Object(c.b)("p",null,"FROM \u53e5\u3092\u66f8\u304d\u63db\u3048\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  DISTINCT user_id,\n  DATETIME(date,\n    time)datetime,\n  amount,\n  item_id\nFROM\n dirty_pos\nWHERE\n  amount>0\n")),Object(c.b)("h3",{id:"rfm_feature-1"},"rfm_feature"),Object(c.b)("p",null,"\u305d\u306e\u307e\u307e\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  user_id,\n  MAX(datetime)recency,\n  COUNT(DISTINCT DATE(datetime))frequency,\n  SUM(amount)monetary\nFROM\n  pos\nGROUP BY\n  user_id\n")),Object(c.b)("h3",{id:"concatinated_features-1"},"concatinated_features"),Object(c.b)("p",null,"\u305d\u306e\u307e\u307e\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  user_id,\n  gender,\n  birth_date,\n  zip_code,\n  recency,\n  frequency,\n  monetary,\n  rfm_array\nFROM\n  user_master\nLEFT JOIN\n  rfm_feature\nUSING\n  (user_id)\nLEFT JOIN\n  rfm_feature_array\nUSING\n  (user_id)\n")),Object(c.b)("h2",{id:"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002"},"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002"),Object(c.b)("p",null,"\u7db2\u7f85\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u7d50\u69cb\u5de5\u6570\u304b\u304b\u308a\u307e\u3059\u304c\u3001\u5883\u754c\u5024\u306e JOIN \u306a\u3069\u7518\u304f\u306a\u308a\u3084\u3059\u3044\u3068\u3053\u308d\u306b\u6c17\u3092\u3064\u3051\u3066\u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\u3092\u4f5c\u308a\u307e\u3059\u3002\u5229\u7528\u56de\u6570\u306e\u591a\u3044\u3082\u306e\u306f\u78ba\u5b9f\u306b\u3001\u30c6\u30b9\u30c8\u3057\u305f\u304f\u306a\u3044\u3082\u306e\u306f\u5ff5\u5165\u308a\u306b\u3001\u3069\u3046\u3057\u3066\u3082\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u3068\u3053\u308d\u306f\u30ec\u30d3\u30e5\u30fc\u3067\u8aa4\u9b54\u5316\u3057\u307e\u3059\u3002"),Object(c.b)("h3",{id:"dirty_user_master"},"dirty_user_master"),Object(c.b)("p",null,"\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u524d\u306e\u30e6\u30fc\u30b6\u30de\u30b9\u30bf\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  *\nFROM\n  UNNEST([STRUCT(2 AS user_id,\n      1 AS gender,\n      DATE'1600-01-01'AS birth_date,\n      '1234567'AS zipcode),(2,\n      1,\n      '1900-01-01',\n      '1234567'),(3,\n      2,\n      '2000-12-12',\n      '126123'),(4,\n      2,\n      '2000-12-12',\n      '1234321'),(5,\n      2,\n      '2100-12-12',\n      '1234321')])\n")),Object(c.b)("h3",{id:"user_master-3"},"user_master"),Object(c.b)("p",null,"\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u5f8c\u306b\u671f\u5f85\u3059\u308b\u30e6\u30fc\u30b6\u30de\u30b9\u30bf\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  *\nFROM\n  UNNEST([STRUCT(2 AS user_id,\n      1 AS gender,\n      DATE'1900-01-01'AS birth_date,\n      '1234567'AS zipcode),(4,\n      2,\n      '2000-12-12',\n      '1234321')])\n")),Object(c.b)("h3",{id:"dirty_pos"},"dirty_pos"),Object(c.b)("p",null,"\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u524d\u306e\u8cfc\u8cb7\u60c5\u5831\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  *\nFROM\n  UNNEST([STRUCT(2 AS user_id,\n      DATE'2000-01-01'AS date,\n      TIME'12:12:12'AS time,\n      1 AS amount,\n      'A'AS item_id),(4,\n      '2000-12-12',\n      '12:00:00',\n      1,\n      'A'),(4,\n      '2000-12-12',\n      '12:04:00',\n      -1,\n      'A'),(4,\n      '2000-12-12',\n      '12:04:00',\n      2,\n      'B'),(5,\n      '2001-12-12',\n      '18:00:00',\n      2,\n      'B')])\n")),Object(c.b)("h3",{id:"dirty_pos-1"},"dirty_pos"),Object(c.b)("p",null,"\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u5f8c\u306b\u671f\u5f85\u3059\u308b\u8cfc\u8cb7\u60c5\u5831\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  *\nFROM\n  UNNEST([STRUCT(2 AS user_id,\n      DATETIME'2000-01-01T12:12:12'AS datetime,\n      1 AS amount,\n      'A'AS item_id),(4,\n      '2000-12-12T12:00:00',\n      1,\n      'A'),(4,\n      '2000-12-12T12:04:00',\n      2,\n      'B'),(5,\n      '2001-12-12T18:00:00',\n      2,\n      'B')])\n")),Object(c.b)("h2",{id:"rfm_feature-2"},"rfm_feature"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\n  *\nFROM\n  UNNEST([STRUCT(2 AS user_id,\n      DATETIME'2000-01-01T12:12:12'AS recency,\n      1 AS frequency,\n      'A'AS monetary),(4,\n      '2000-12-12T12:04:00',\n      2,\n      3),(5,\n      '2001-12-12T18:00:00',\n      1,\n      2)])\n")),Object(c.b)("h2",{id:"sql-\u30d5\u30a1\u30a4\u30eb\u306b\u3001\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092-function-\u304b-with-\u53e5\u3068\u3057\u3066\u7d50\u5408\u3059\u308b\u3002"},"SQL \u30d5\u30a1\u30a4\u30eb\u306b\u3001\u30c6\u30b9\u30c8\u7528\u306e\u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092 FUNCTION \u304b WITH \u53e5\u3068\u3057\u3066\u7d50\u5408\u3059\u308b\u3002"),Object(c.b)("p",null,"SQL \u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u89e3\u6d88\u3067\u304d\u308b\u3088\u3046\u306b\u30af\u30a8\u30ea\u3092\u7d50\u5408\u3057\u307e\u3059\u3002\u3044\u308d\u3044\u308d\u8a66\u884c\u932f\u8aa4\u3057\u306a\u304c\u3089\u3001\u3053\u308c\u304c\u3067\u304d\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u5b8c\u6210\u5ea6\u306b\u306a\u3063\u305f\u3089\u304a\u62ab\u9732\u76ee\u3057\u307e\u3059\u3002\n\u6700\u4f4e\u9650\u3001\u4efb\u610f\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u304b\u3089\u3001sql \u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u4e2d\u8eab\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6587\u5b57\u5217\u306b\u5165\u308c\u3089\u308c\u308c\u3070\u826f\u3044\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"WITH\n  dirty_user_master AS(/* dirty_user_master \u306e\u30af\u30a8\u30ea\u3092\u57cb\u3081\u8fbc\u3080 */),\n  actual AS(/* user_master \u306e\u30af\u30a8\u30ea\u3092\u57cb\u3081\u8fbc\u3080 */),\n  expected AS(/* user_master \u306e\u671f\u5f85\u5024\u30af\u30a8\u30ea\u3092\u57cb\u3081\u8fbc\u3080 */)\n")),Object(c.b)("h2",{id:"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u529b\u6642\u306b\u3001\u30c6\u30b9\u30c8\u7528\u51fa\u529b\u304c\u8fd4\u3063\u3066\u304f\u308b\u304b\u30c6\u30fc\u30d6\u30eb\u3092\u6bd4\u8f03\u3059\u308b\u3002"},"\u30c6\u30b9\u30c8\u7528\u306e\u5165\u529b\u6642\u306b\u3001\u30c6\u30b9\u30c8\u7528\u51fa\u529b\u304c\u8fd4\u3063\u3066\u304f\u308b\u304b\u30c6\u30fc\u30d6\u30eb\u3092\u6bd4\u8f03\u3059\u308b\u3002"),Object(c.b)("p",null,"\u4e0a\u306e\u30af\u30a8\u30ea\u3092\u304f\u3063\u3064\u3051\u308c\u3070\u30c6\u30b9\u30c8\u30af\u30a8\u30ea\u306e\u5b8c\u6210\u3067\u3059\u3002\n\u540c\u3058\u5217\uff08\u91cd\u8907\u3001\u914d\u5217\u3001\u69cb\u9020\u4f53\u975e\u5bfe\u5fdc\uff09\u306a\u3089 TRUE \u3092\u8fd4\u3057\u3001\u305d\u3046\u3067\u306a\u3044\u306a\u3089 ERROR \u3092\u5410\u304f\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\nIF\n  (EXISTS((\n      SELECT\n        *\n      FROM\n        expected EXCEPT DISTINCT\n      SELECT\n        *\n      FROM\n        actual)\n    UNION ALL (\n      SELECT\n        *\n      FROM\n        actual EXCEPT DISTINCT\n      SELECT\n        *\n      FROM\n        expected)),\n    ERROR(TO_JSON_STRING(STRUCT('ValidationError'AS message,\n          ['actual does not equal expected']AS errors))),\n    TRUE)\n")),Object(c.b)("p",null,"\u4ee5\u4e0a\u3067\u3001\u7c21\u5358\u306a\u30c6\u30b9\u30c8\u306f\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u30c6\u30b9\u30c8\u304c\u306a\u3044\u3068\u904b\u7528\u6642\u306b\u52d5\u4f5c\u4fdd\u8a3c\u304c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001BigQuery \u3067\u51e6\u7406\u3092\u591a\u6bb5\u306b\u884c\u3046\u969b\u306b\u306f\u3001\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("h1",{id:"\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u540c\u5b9a\u6cd5"},"\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u540c\u5b9a\u6cd5"),Object(c.b)("p",null,"\u3053\u308c\u307e\u3067\u3067\u3001\u30c7\u30fc\u30bf\u5909\u63db\u306e\u30c6\u30b9\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u3057\u304b\u3057\u3001\u6a5f\u68b0\u5b66\u7fd2\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u7d99\u7d9a\u7684\u306b\u56de\u3059\u305f\u3081\u306b\u306f\u3001\u30c7\u30fc\u30bf\u5909\u63db\u306e\u30c6\u30b9\u30c8\u3060\u3051\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002\u5165\u529b\u30c7\u30fc\u30bf\u304c\u52a3\u5316\u3057\u3066\u3044\u306a\u3044\u304b\u8abf\u3079\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u95a2\u3057\u3066\u306f\u3001\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5236\u7d04\u78ba\u8a8d\u3068\u3001\u8981\u7d04\u7d71\u8a08\u91cf\u306e\u6bd4\u8f03\u306b\u3088\u3063\u3066\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3067\u304d\u308b\u306e\u3067\u306f\u3068\u4eee\u8aac\u3092\u7acb\u3066\u3066\u4ed5\u7d44\u307f\u3065\u304f\u308a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("h2",{id:"\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5236\u7d04"},"\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5236\u7d04"),Object(c.b)("p",null,"\u30ea\u30ec\u30fc\u30b7\u30e7\u30ca\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5b58\u5728\u3057\u3001BigQuery \u306b\u5b58\u5728\u3057\u306a\u3044\u306e\u304c\u3001\u5236\u7d04\u3067\u3059\u3002"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"CHECK"),Object(c.b)("li",{parentName:"ol"},"NOT NULL"),Object(c.b)("li",{parentName:"ol"},"UNIQUE"),Object(c.b)("li",{parentName:"ol"},"FOREIGN KEY\n\u306b\u3064\u3044\u3066\u306f\u3001\u3068\u3066\u3082\u91cd\u8981\u306a\u5236\u7d04\u3067\u3059\u306e\u3067\u3001\u30c7\u30fc\u30bf\u5206\u6790\u3092\u884c\u3046\u969b\u306b\u306f\u6c17\u3092\u3064\u3051\u3066\u3044\u308b\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002")),Object(c.b)("h3",{id:"check"},"CHECK"),Object(c.b)("p",null,"check expression \u304c\u6210\u308a\u7acb\u3063\u3066\u3044\u306a\u3044\u5217\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u793e\u5185\u3067\u306f\u6a19\u6e96\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u3044\u3066\u3001\u30b9\u30ad\u30fc\u30de\u30d9\u30fc\u30b9\u3067\u5024\u57df\u3084\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\nIF\n  (EXISTS((\n      SELECT\n        *\n      FROM\n        my_dataset.my_table\n      WHERE\n        NOT /* check expression */)),\n    ERROR(TO_JSON_STRING(STRUCT('ValidationError'AS message,\n          ['checks failed']AS errors))),\n    TRUE)\n")),Object(c.b)("h3",{id:"not-null"},"NOT NULL"),Object(c.b)("p",null,"column \u304c NULL \u3067\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002BigQuery \u306e REQUIRED \u3067\u6e08\u3081\u3070\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u304a\u5ba2\u69d8\u304b\u3089\u3044\u305f\u3060\u304f\u30c7\u30fc\u30bf\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u63fa\u308c\u305f\u6642\u306b\u5bfe\u51e6\u3067\u304d\u306a\u3044\u305f\u3081\u3001NULLABLE \u3067\u53d6\u308a\u8fbc\u3093\u3067\u3053\u306e\u30c1\u30a7\u30c3\u30af\u3092\u5b9f\u65bd\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\nIF\n  (EXISTS((\n      SELECT\n        *\n      FROM\n        my_dataset.my_table\n      WHERE\n        /* column */ IS NULL)),\n    ERROR(TO_JSON_STRING(STRUCT('ValidationError'AS message,\n          ['checks failed']AS errors))),\n    TRUE)\n")),Object(c.b)("h3",{id:"unique"},"UNIQUE"),Object(c.b)("p",null,"column1, column2 \u304c\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30e6\u30cb\u30fc\u30af\u4fdd\u8a3c\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u6642\u6298\u78ba\u8a8d\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u3060\u3068\u601d\u3044\u8fbc\u3093\u3067\u3044\u308b\u3082\u306e\u306e JOIN \u3067\u30c6\u30fc\u30d6\u30eb\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u53d6\u308a\u8fd4\u3057\u306e\u3064\u304b\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\nIF\n  (EXISTS((\n      SELECT\n        *\n      FROM\n        my_dataset.my_table\n      WHERE\n        /* column1 */ IS NOT NULL\n        AND /* column2 */ IS NOT NULL\n      GROUP BY\n        /* column1 */,\n        /* column2 */\n      HAVING\n        COUNT(*)>1)),\n    ERROR(TO_JSON_STRING(STRUCT('ValidationError'AS message,\n          ['checks failed']AS errors))),\n    TRUE)\n")),Object(c.b)("h3",{id:"foreign-key"},"FOREIGN KEY"),Object(c.b)("p",null,"my_table1.key1, key2 \u304c my_table2.key1, key2 \u3092\u5168\u3066\u542b\u6709\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u304c\u3064\u3044\u3066\u304a\u3089\u305a\u3001\u624b\u52d5\u904b\u7528\u306e\u672b\u306b\u4e0d\u6574\u5408\u304c\u8d77\u304d\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3082\u898b\u304b\u3051\u307e\u3059\u3002\u305d\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u304c\u5fc5\u8981\u306a\u6642\u306f\u4ee5\u4e0b\u306e\u30af\u30a8\u30ea\u3067\u78ba\u8a8d\u3057\u3001\u5fc5\u9808\u3067\u306a\u3044\u306a\u3089\u4e0d\u6574\u5408\u5272\u5408\u3092\u898b\u3066\u554f\u984c\u306e\u5927\u304d\u3055\u306b\u3088\u3063\u3066\u7121\u8996\u3059\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sql"}),"SELECT\nIF\n  (EXISTS((\n      SELECT\n        *\n      FROM\n        my_dataset.my_table1\n      LEFT JOIN\n        my_dataset.my_table2\n      ON\n        my_table1.key1=my_table2.key1\n        AND my_table1.key2=my_table2.key2\n      WHERE\n        my_table2.key1 IS NULL\n        OR my_table2.key2 IS NULL)),\n    ERROR(TO_JSON_STRING(STRUCT('ValidationError'AS message,\n          ['checks failed']AS errors))),\n    TRUE)\n")),Object(c.b)("h2",{id:"\u8981\u7d04\u7d71\u8a08\u91cf\u306e\u6bd4\u8f03"},"\u8981\u7d04\u7d71\u8a08\u91cf\u306e\u6bd4\u8f03"),Object(c.b)("p",null,"\u5236\u7d04\u3060\u3051\u3067\u306f\u3001\u30c7\u30fc\u30bf\u306e\u8cea\u304c\u5909\u308f\u3063\u305f\u3053\u3068\u3092\u691c\u77e5\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306b\u3001\u793e\u5185\u3067\u306f\u8981\u7d04\u7d71\u8a08\u91cf\u3092\u7b97\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\u8d85\u5de8\u5927\u306a\u30c7\u30fc\u30bf\u3082\u8981\u7d04\u7d71\u8a08\u91cf\u3092\u4e00\u5ea6\u8a08\u7b97\u3057\u3066\u304a\u3051\u3070\u3001\u6bd4\u8f03\u306e\u30b3\u30b9\u30c8\u304c\u5c0f\u3055\u3044\u70b9\u3082\u9b45\u529b\u3067\u3059\u3002\u624b\u52d5\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u30ab\u30c6\u30b4\u30ea\u5909\u6570\u306b\u5dee\u7570\u304c\u306a\u3044\u304b\u3001\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u5927\u304d\u306a\u305a\u308c\u304c\u306a\u3044\u304b\u3092\u76ee\u8996\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("h3",{id:"tensorflow-data-validation"},"Tensorflow Data Validation"),Object(c.b)("p",null,"Tensorflow Data Validation \u306f visualize_statistics \u3067\u30c7\u30fc\u30bf\u306e\u53ef\u8996\u5316\u3001validate_statistics \u306b\u3066\u30c7\u30fc\u30bf\u306e\u540c\u5b9a\u3092\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002"),Object(c.b)("h3",{id:"pandas-profiling"},"pandas-profiling"),Object(c.b)("p",null,"pandas-profiling \u306f\u3082\u3046\u5c11\u3057\u5c0f\u3055\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5411\u304d\u3067\u3001\u30c7\u30fc\u30bf\u306e\u53ef\u8996\u5316\u3092\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002\u5c0f\u3055\u304f\u3066\u521d\u3081\u307e\u3057\u3066\u306e\u30c7\u30fc\u30bf\u306b\u3064\u3044\u3066\u306f\u3053\u308c\u304c\u304a\u624b\u8efd\u3067\u3059\u3002"),Object(c.b)("h3",{id:"bq_profile"},"bq_profile"),Object(c.b)("p",null,Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://qiita.com/rhoboro/items/c61e81246f87d346e656"}),"bq_profile")," \u306f\u540c\u50da\u306e rhoboro \u6c0f\u306b\u4f5c\u3063\u3066\u3044\u305f\u3060\u3044\u305f\u3001BigQuery \u3067\u8981\u7d04\u7d71\u8a08\u91cf\u3092\u898b\u305f\u3044\u3068\u304d\u306b\u4f7f\u3048\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u53ef\u8996\u5316\u3088\u308a\u3082\u3001\u7d99\u7d9a\u3057\u3066\u3044\u304f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u3067\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u52a3\u5316\u304c\u306a\u3044\u304b\u78ba\u304b\u3081\u308b\u306e\u306b\u91cd\u304d\u3092\u304a\u3044\u3066\u4f5c\u3063\u3066\uff08\u3044\u308b\u3068\u8a8d\u8b58\u3057\u3066\uff09\u304a\u308a\u3001\u5927\u304d\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u3082\u9ad8\u901f\u306b\u52d5\u4f5c\u3059\u308b\u305f\u3081\u591a\u7528\u3057\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("h1",{id:"\u304a\u308f\u308a\u306b"},"\u304a\u308f\u308a\u306b"),Object(c.b)("p",null,"\u8981\u7d04\u7d71\u8a08\u91cf\u306e\u6bd4\u8f03\u306f\u30c4\u30fc\u30eb\u7d39\u4ecb\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u793e\u5185\u3067\u306f BigQuery \u3092\u3044\u304b\u306b\u904b\u7528\u54c1\u8cea\u3067\u4f7f\u3063\u3066\u3044\u304f\u304b\u3092\u691c\u8a0e\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u3001\u30c7\u30fc\u30bf\u5909\u63db\u304c\u9593\u9055\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u3001\u5165\u529b\u30c7\u30fc\u30bf\u54c1\u8cea\u306b\u52a3\u5316\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u4ed5\u7d44\u307f\u3068\u3057\u3066\u4e0a\u8a18\u306e\u3088\u3046\u306a\u4ed5\u7d44\u307f\u3092\u8a66\u3057\u3066\u3044\u307e\u3059\u3002\u3082\u3057\u826f\u3044\u3084\u308a\u65b9\u3092\u3054\u5b58\u77e5\u3067\u3042\u308c\u3070\u3001\u305c\u3072\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002"))}u.isMDXComponent=!0},215:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return _}));var r=t(0),a=t.n(r);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function b(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var d=a.a.createContext({}),u=function(e){var n=a.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=u(e.components);return a.a.createElement(d.Provider,{value:n},e.children)},o={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},O=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,i=e.parentName,d=b(e,["components","mdxType","originalType","parentName"]),s=u(t),O=r,_=s["".concat(i,".").concat(O)]||s[O]||o[O]||c;return t?a.a.createElement(_,l(l({ref:n},d),{},{components:t})):a.a.createElement(_,l({ref:n},d))}));function _(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,i=new Array(c);i[0]=O;var l={};for(var b in n)hasOwnProperty.call(n,b)&&(l[b]=n[b]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<c;d++)i[d]=t[d];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}O.displayName="MDXCreateElement"}}]);