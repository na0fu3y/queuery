<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Queuery Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Queuery Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156581645-3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-156581645-3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Queuery" href="/opensearch.xml"><title data-react-helmet="true">åˆ†æ SQL ã®ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ«ã®ææ¡ˆ | Queuery</title><meta data-react-helmet="true" property="og:title" content="åˆ†æ SQL ã®ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ«ã®ææ¡ˆ | Queuery"><meta data-react-helmet="true" name="description" content="ã“ã®è¨˜äº‹ã¯ bqsushi ã§ç™ºè¡¨ã—ãŸ BigQuery ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã®æš—é»’é¢ ã®å€‹äººçš„ãªè§£èª¬ã§ã™ã€‚"><meta data-react-helmet="true" property="og:description" content="ã“ã®è¨˜äº‹ã¯ bqsushi ã§ç™ºè¡¨ã—ãŸ BigQuery ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã®æš—é»’é¢ ã®å€‹äººçš„ãªè§£èª¬ã§ã™ã€‚"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/styles.05447168.css">
<link rel="preload" href="/styles.5c08f17d.js" as="script">
<link rel="preload" href="/runtime~main.54d8ed7a.js" as="script">
<link rel="preload" href="/main.8cc151df.js" as="script">
<link rel="preload" href="/1.72e98765.js" as="script">
<link rel="preload" href="/2.7889eed3.js" as="script">
<link rel="preload" href="/3.41c7bdcc.js" as="script">
<link rel="preload" href="/ccc49370.a83013a9.js" as="script">
<link rel="preload" href="/9c0a0ea5.583a3e0c.js" as="script">
<link rel="preload" href="/2e70a6ea.ccdcd855.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Queuery</strong></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/na0fu3y/queuery" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Queuery</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/na0fu3y/queuery" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/12/15/designing-with-analytics">ãƒ‡ãƒ¼ã‚¿æ´»ç”¨çµ„ç¹”ã‚’é€²ã‚ã‚‹æŒ¯ã‚Šè¿”ã‚Š</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/25/bq-fun-slack">BQ FUN Slackã‚’ç«‹ã¡ä¸Šã’ãŸè©±</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/11/prefect">Prefect è§¦ã£ã¦ã¿ãŸ</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/11/python-docker">Python é–‹ç™ºç’°å¢ƒã® Docker åŒ–</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/28/gcp-logging">Stackdriver Logging ã§ã§ãã‚‹ã“ã¨</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_3-lP">åˆ†æ SQL ã®ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ«ã®ææ¡ˆ</h1><div class="margin-vert--md"><time datetime="2020-01-21T00:00:00.000Z" class="blogPostDate_Ta7i">January 21, 2020  Â· 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/na0fu3y" target="_blank" rel="noreferrer noopener"><img src="https://avatars0.githubusercontent.com/u/17900178?s=400&amp;v=4" alt="Naofumi Yamada"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/na0fu3y" target="_blank" rel="noreferrer noopener">Naofumi Yamada</a></h4><small class="avatar__subtitle">Data Engineer</small></div></div></header><section class="markdown"><p>ã“ã®è¨˜äº‹ã¯ bq_sushi ã§ç™ºè¡¨ã—ãŸ <a href="https://docs.google.com/presentation/d/e/2PACX-1vQa0h1sf1UQLOR8Owj00fkDaG_QberK-8M-4RYAFF8IBC8JYyDlADETxCfza7aynVzm9L3-9TkCz-_r/pub?slide=id.g7b4fd3bc26_0_0" target="_blank" rel="noopener noreferrer">BigQuery ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã®æš—é»’é¢</a> ã®å€‹äººçš„ãªè§£èª¬ã§ã™ã€‚</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«<a class="hash-link" href="#ã¯ã˜ã‚ã«" title="Direct link to heading">#</a></h1><p>å¾“æ¥ã®ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆOracle ã‚„ SQL Serverã€MySQL ãªã©ï¼‰ã§ã¯ã€ãªã‚‹ã¹ãå‡¦ç†ã‚’å°‘ãªãã™ã‚‹ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ä¸­å¿ƒã®æ¯”è¼ƒçš„çŸ­ã„ SQL ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã—ãŸã€‚ã—ã‹ã—ã€BigQuery ã§ã¯ã‚³ã‚¹ãƒ‘è‰¯ããƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ‰‹ç¶šãä¸­å¿ƒã®æ¯”è¼ƒçš„é•·ã„ SQL ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ï¼ˆ<a href="https://qiita.com/piyoSakai/items/e1b97366ca5940dad517" target="_blank" rel="noopener noreferrer">Bigqueryæ™‚ä»£ã«ãŠã‘ã‚‹ã€åˆ†æSQLã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã®æå”±</a> ã‚„ <a href="https://techlife.cookpad.com/entry/2016/11/09/000033" target="_blank" rel="noopener noreferrer">åˆ†æSQLã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«</a>ï¼‰ã®è­°è«–ã¯ã‚ã‚Šã¾ã™ãŒã€SQL ã®ç¶™ç¶šçš„ãªé–‹ç™ºè«–ã¯ç¢ºç«‹ã—ã¦ã„ãªã•ãã†ã§ã™ã€‚</p><p>æœ¬ç¨¿ã§ã¯ã€<strong>SQL ã‚’ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã«ä¹—ã›ã€ç¶™ç¶šçš„ãªé–‹ç™ºé‹ç”¨ã‚’è¡Œã†</strong> ã“ã¨ã‚’ç›®çš„ã¨ã—ã€åˆ†æ SQL ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã¨ãƒ‡ãƒ¼ã‚¿å“è³ªã®åŒå®šæ³•ã«ã¤ã„ã¦è¿°ã¹ã¾ã™ã€‚</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="åˆ†æ-sql-ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•"></a>åˆ†æ SQL ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•<a class="hash-link" href="#åˆ†æ-sql-ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•" title="Direct link to heading">#</a></h1><p>åˆ†æ SQL ã‚’ãƒ†ã‚¹ãƒˆå¯èƒ½ã«ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®å·¥ç¨‹ã‚’è¸ã¿ã¾ã™ã€‚</p><ol><li>æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’ FUNCTION ã‹ WITH å¥ã«åˆ†é›¢ã™ã‚‹ã€‚</li><li>å¯å¤‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã€SQL ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚</li><li>ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚</li><li>SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ FUNCTION ã‹ WITH å¥ã¨ã—ã¦çµåˆã™ã‚‹ã€‚</li><li>ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›æ™‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’-function-ã‹-with-å¥ã«åˆ†é›¢ã™ã‚‹ã€‚"></a>æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’ FUNCTION ã‹ WITH å¥ã«åˆ†é›¢ã™ã‚‹ã€‚<a class="hash-link" href="#æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’-function-ã‹-with-å¥ã«åˆ†é›¢ã™ã‚‹ã€‚" title="Direct link to heading">#</a></h2><p>ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã‚’ä¾‹ã«å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯æ„å‘³å˜ä½ã«ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- èª•ç”Ÿæ—¥ã® 5% ç‚¹ã‚’è¦‹ã¤ã‘ã‚‹é–¢æ•°</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- å¤–ã‚Œå€¤ã®é™¤å»ã«åˆ©ç”¨ã™ã‚‹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  birth_date_percentile_5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      APPROX_QUANTILES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">OFFSET</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      mydataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirty_user_master</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ãã‚Œã„ã«ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- user_id: ãƒ¦ãƒ¼ã‚¶ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ä¸»ã‚­ãƒ¼ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- gender: æ€§åˆ¥ã€&#x27;ç”·&#x27; ã‹ &#x27;å¥³&#x27; ã‹ NULL ã‚’æŒã¤ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- birth_date: 5% ç‚¹ã¨ 18 æ­³ä»¥ä¸Šã§ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã—ãŸèª•ç”Ÿæ—¥ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- zip_code: ãƒã‚¤ãƒ•ãƒ³ãªã— 7 æ¡ã®éƒµä¾¿ç•ªå·ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">user_master</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> gender</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ç”·&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;å¥³&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_date_percentile_5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain">birth_date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> birth_date</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">DATE_SUB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CURRENT_DATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">REGEXP_CONTAINS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^\\d{7}$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">zip_code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirty_user_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- è³¼è²·æƒ…å ±ã‚’ãã‚Œã„ã«ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- user_id: ãƒ¦ãƒ¼ã‚¶ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ã‚­ãƒ¼ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- datetime: å–å¼•æ—¥ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- amount: è³¼å…¥é‡‘é¡ã€è¿”å“ã§ãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹ã®ã‚’é™¤å»ã—ã¦ã‚ã‚‹ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- item_id: å•†å“ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ã‚­ãƒ¼ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">DATETIME</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    item_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mydataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirty_pos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    amount</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- pos ã‹ã‚‰ RFM åˆ†æã—ãŸç‰¹å¾´é‡ãƒ†ãƒ¼ãƒ–ãƒ«</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- user_id: ãƒ¦ãƒ¼ã‚¶ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ã‚­ãƒ¼ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- recency: æœ€æ–°è³¼å…¥æ—¥ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- frequency: è³¼è²·æ—¥æ•°ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- monetary: ç·è³¼è²·é‡‘é¡ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">rfm_feature</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">monetary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- æ©Ÿæ¢°å­¦ç¿’ã«æŠ•å…¥ã™ã‚‹ãƒ‡ãƒ¼ã‚¿</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- user_id: ãƒ¦ãƒ¼ã‚¶ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ä¸»ã‚­ãƒ¼ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- gender: æ€§åˆ¥ã€&#x27;ç”·&#x27; ã‹ &#x27;å¥³&#x27; ã‹ NULL ã‚’æŒã¤ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- birth_date: 5% ç‚¹ã¨ 18 æ­³ä»¥ä¸Šã§ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã—ãŸèª•ç”Ÿæ—¥ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- zip_code: ãƒã‚¤ãƒ•ãƒ³ãªã— 7 æ¡ã®éƒµä¾¿ç•ªå·ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- recency: æœ€æ–°è³¼å…¥æ—¥ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- frequency: è³¼è²·æ—¥æ•°ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- monetary: ç·è³¼è²·é‡‘é¡ã€‚</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  monetary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_feature</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="birth_date_percentile_5"></a>birth_date_percentile_5<a class="hash-link" href="#birth_date_percentile_5" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    APPROX_QUANTILES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OFFSET</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mydataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirty_user_master</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="user_master"></a>user_master<a class="hash-link" href="#user_master" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> gender</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ç”·&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;å¥³&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_date_percentile_5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain">birth_date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> birth_date</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">DATE_SUB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CURRENT_DATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">REGEXP_CONTAINS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^\\d{7}$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">zip_code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirty_user_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pos"></a>pos<a class="hash-link" href="#pos" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DATETIME</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  item_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mydataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirty_pos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  amount</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rfm_feature"></a>rfm_feature<a class="hash-link" href="#rfm_feature" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">monetary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  pos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="concatinated_features"></a>concatinated_features<a class="hash-link" href="#concatinated_features" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  monetary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_array</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_feature</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_feature_array</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å¯å¤‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã€sql-ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚"></a>å¯å¤‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã€SQL ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚<a class="hash-link" href="#å¯å¤‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã€sql-ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚" title="Direct link to heading">#</a></h2><p>åˆ†å‰²ãŒçµ‚ã‚ã£ãŸã‚‰ã€FUNCTION ä»¥å¤–ã®ã„ãã¤ã‹æŒã£ã¦ã„ã‚‹å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã¾ã™ã€‚ã“ã‚Œã‚’ã‚„ã£ã¦ãŠãã“ã¨ã§ãƒ†ã‚¹ãƒˆã®æ™‚ã«ã¯ã€WITH å¥ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã€å®Ÿåˆ©ç”¨æ™‚ã¯ WITH å¥ã§å®Ÿãƒ†ãƒ¼ãƒ–ãƒ«æŠ•å…¥ãŒã§ãã¾ã™ã€‚
ãƒ†ãƒ¼ãƒ–ãƒ«å‚ç…§ã‚’æŒã¤ FUNCTION ã«é–¢ã—ã¦ã¯å–ã‚Šé™¤ã‘ãªã„ï¼ˆARRAY_AGG ã—ã¦å¼•æ•°ã«æ¸¡ã›ã°å°ã•ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ¸¡ã›ã‚‹ãŒå¤§ãã„ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾å¿œã§ããªã„ï¼‰ã®ã§ã€ãã®ã¾ã¾å‚ç…§é€éæ€§ã‚’ä¿è¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="birth_date_percentile_5-1"></a>birth_date_percentile_5<a class="hash-link" href="#birth_date_percentile_5-1" title="Direct link to heading">#</a></h3><p>è«¦ã‚ã¦æ”¾ç½®ã‹ã€ã“ã‚Œãã‚‰ã„ãªã‚‰ã‚¯ã‚¨ãƒªãŒæ­£ã—ã„ã“ã¨ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã¦é€šã™ã€‚
ä»Šå›ã¯ã€ARRAY_AGG ã—ãŸçµæœã‚’å—ã‘å–ã‚‹ã“ã¨ã«ã—ã¦å¯¾å¿œã™ã‚‹ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    APPROX_QUANTILES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OFFSET</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    UNNEST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_dates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="user_master-1"></a>user_master<a class="hash-link" href="#user_master-1" title="Direct link to heading">#</a></h3><p>FROM å¥ã‚’æ›¸ãæ›ãˆã€CURRENT_DATE() ã¯å†ç¾æ€§ãŒãªã„ã®ã§ã€é–¢æ•°ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦å®šæ•°ã‚’å…¥ã‚ŒãŸã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="my_current_date"></a>MY_CURRENT_DATE<a class="hash-link" href="#my_current_date" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2019-12-10&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="user_master-2"></a>user_master<a class="hash-link" href="#user_master-2" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> gender</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ç”·&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;å¥³&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">birth_date_percentile_5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain">birth_date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> birth_date</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">DATE_SUB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">MY_CURRENT_DATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ANY_VALUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">REGEXP_CONTAINS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^\\d{7}$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">zip_code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dirty_user_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pos-1"></a>pos<a class="hash-link" href="#pos-1" title="Direct link to heading">#</a></h3><p>FROM å¥ã‚’æ›¸ãæ›ãˆã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DATETIME</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  item_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> dirty_pos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  amount</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rfm_feature-1"></a>rfm_feature<a class="hash-link" href="#rfm_feature-1" title="Direct link to heading">#</a></h3><p>ãã®ã¾ã¾ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">monetary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  pos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="concatinated_features-1"></a>concatinated_features<a class="hash-link" href="#concatinated_features-1" title="Direct link to heading">#</a></h3><p>ãã®ã¾ã¾ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  zip_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  monetary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_array</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user_master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_feature</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rfm_feature_array</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚"></a>ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚<a class="hash-link" href="#ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚" title="Direct link to heading">#</a></h2><p>ç¶²ç¾…ã—ã‚ˆã†ã¨ã™ã‚‹ã¨çµæ§‹å·¥æ•°ã‹ã‹ã‚Šã¾ã™ãŒã€å¢ƒç•Œå€¤ã® JOIN ãªã©ç”˜ããªã‚Šã‚„ã™ã„ã¨ã“ã‚ã«æ°—ã‚’ã¤ã‘ã¦ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚Šã¾ã™ã€‚åˆ©ç”¨å›æ•°ã®å¤šã„ã‚‚ã®ã¯ç¢ºå®Ÿã«ã€ãƒ†ã‚¹ãƒˆã—ãŸããªã„ã‚‚ã®ã¯å¿µå…¥ã‚Šã«ã€ã©ã†ã—ã¦ã‚‚ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ã¨ã“ã‚ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§èª¤é­”åŒ–ã—ã¾ã™ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dirty_user_master"></a>dirty_user_master<a class="hash-link" href="#dirty_user_master" title="Direct link to heading">#</a></h3><p>ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å‰ã®ãƒ¦ãƒ¼ã‚¶ãƒã‚¹ã‚¿ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNNEST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DATE</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1600-01-01&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1234567&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> zipcode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1900-01-01&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1234567&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;126123&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1234321&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2100-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1234321&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="user_master-3"></a>user_master<a class="hash-link" href="#user_master-3" title="Direct link to heading">#</a></h3><p>ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å¾Œã«æœŸå¾…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒã‚¹ã‚¿ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNNEST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DATE</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1900-01-01&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> birth_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1234567&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> zipcode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1234321&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dirty_pos"></a>dirty_pos<a class="hash-link" href="#dirty_pos" title="Direct link to heading">#</a></h3><p>ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å‰ã®è³¼è²·æƒ…å ±ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNNEST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DATE</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-01-01&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">TIME</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;12:12:12&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;12:00:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;12:04:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;12:04:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;B&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2001-12-12&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;18:00:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;B&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dirty_pos-1"></a>dirty_pos<a class="hash-link" href="#dirty_pos-1" title="Direct link to heading">#</a></h3><p>ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å¾Œã«æœŸå¾…ã™ã‚‹è³¼è²·æƒ…å ±ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNNEST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DATETIME</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-01-01T12:12:12&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12T12:00:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12T12:04:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;B&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2001-12-12T18:00:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;B&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rfm_feature-2"></a>rfm_feature<a class="hash-link" href="#rfm_feature-2" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  UNNEST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DATETIME</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-01-01T12:12:12&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> recency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> frequency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> monetary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2000-12-12T12:04:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2001-12-12T18:00:00&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sql-ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’-function-ã‹-with-å¥ã¨ã—ã¦çµåˆã™ã‚‹ã€‚"></a>SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ FUNCTION ã‹ WITH å¥ã¨ã—ã¦çµåˆã™ã‚‹ã€‚<a class="hash-link" href="#sql-ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’-function-ã‹-with-å¥ã¨ã—ã¦çµåˆã™ã‚‹ã€‚" title="Direct link to heading">#</a></h2><p>SQL ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ¶ˆã§ãã‚‹ã‚ˆã†ã«ã‚¯ã‚¨ãƒªã‚’çµåˆã—ã¾ã™ã€‚ã„ã‚ã„ã‚è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ã€ã“ã‚ŒãŒã§ãã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½œã£ã¦ã„ã‚‹ã®ã§ã€ã‚ã‚‹ç¨‹åº¦ã®å®Œæˆåº¦ã«ãªã£ãŸã‚‰ãŠæŠ«éœ²ç›®ã—ã¾ã™ã€‚
æœ€ä½é™ã€ä»»æ„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‹ã‚‰ã€sql ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ä¸­èº«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã«å…¥ã‚Œã‚‰ã‚Œã‚Œã°è‰¯ã„ã§ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dirty_user_master </span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* dirty_user_master ã®ã‚¯ã‚¨ãƒªã‚’åŸ‹ã‚è¾¼ã‚€ */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  actual </span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* user_master ã®ã‚¯ã‚¨ãƒªã‚’åŸ‹ã‚è¾¼ã‚€ */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  expected </span><span class="token keyword" style="font-style:italic">AS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* user_master ã®æœŸå¾…å€¤ã‚¯ã‚¨ãƒªã‚’åŸ‹ã‚è¾¼ã‚€ */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›æ™‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚"></a>ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›æ™‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚<a class="hash-link" href="#ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›æ™‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚" title="Direct link to heading">#</a></h2><p>ä¸Šã®ã‚¯ã‚¨ãƒªã‚’ãã£ã¤ã‘ã‚Œã°ãƒ†ã‚¹ãƒˆã‚¯ã‚¨ãƒªã®å®Œæˆã§ã™ã€‚
åŒã˜åˆ—ï¼ˆé‡è¤‡ã€é…åˆ—ã€æ§‹é€ ä½“éå¯¾å¿œï¼‰ãªã‚‰ TRUE ã‚’è¿”ã—ã€ãã†ã§ãªã„ãªã‚‰ ERROR ã‚’åãã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        expected </span><span class="token keyword" style="font-style:italic">EXCEPT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        actual</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        actual </span><span class="token keyword" style="font-style:italic">EXCEPT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DISTINCT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        expected</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TO_JSON_STRING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ValidationError&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;actual does not equal expected&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ä»¥ä¸Šã§ã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆã¯ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ãƒ†ã‚¹ãƒˆãŒãªã„ã¨é‹ç”¨æ™‚ã«å‹•ä½œä¿è¨¼ãŒã§ããªããªã£ã¦ã—ã¾ã†ã®ã§ã€BigQuery ã§å‡¦ç†ã‚’å¤šæ®µã«è¡Œã†éš›ã«ã¯ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ãƒ‡ãƒ¼ã‚¿å“è³ªã®åŒå®šæ³•"></a>ãƒ‡ãƒ¼ã‚¿å“è³ªã®åŒå®šæ³•<a class="hash-link" href="#ãƒ‡ãƒ¼ã‚¿å“è³ªã®åŒå®šæ³•" title="Direct link to heading">#</a></h1><p>ã“ã‚Œã¾ã§ã§ã€ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ãƒ†ã‚¹ãƒˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ã—ã‹ã—ã€æ©Ÿæ¢°å­¦ç¿’ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¶™ç¶šçš„ã«å›ã™ãŸã‚ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ãƒ†ã‚¹ãƒˆã ã‘ã§ã¯ä¸ååˆ†ã§ã™ã€‚å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒåŠ£åŒ–ã—ã¦ã„ãªã„ã‹èª¿ã¹ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«é–¢ã—ã¦ã¯ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„ç¢ºèªã¨ã€è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã®ã§ã¯ã¨ä»®èª¬ã‚’ç«‹ã¦ã¦ä»•çµ„ã¿ã¥ãã‚Šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„"></a>ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„<a class="hash-link" href="#ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„" title="Direct link to heading">#</a></h2><p>ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã—ã€BigQuery ã«å­˜åœ¨ã—ãªã„ã®ãŒã€åˆ¶ç´„ã§ã™ã€‚</p><ol><li>CHECK</li><li>NOT NULL</li><li>UNIQUE</li><li>FOREIGN KEY
ã«ã¤ã„ã¦ã¯ã€ã¨ã¦ã‚‚é‡è¦ãªåˆ¶ç´„ã§ã™ã®ã§ã€ãƒ‡ãƒ¼ã‚¿åˆ†æã‚’è¡Œã†éš›ã«ã¯æ°—ã‚’ã¤ã‘ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="check"></a>CHECK<a class="hash-link" href="#check" title="Direct link to heading">#</a></h3><p>check expression ãŒæˆã‚Šç«‹ã£ã¦ã„ãªã„åˆ—ãŒãªã„ã‹ç¢ºèªã—ã¾ã™ã€‚
ç¤¾å†…ã§ã¯æ¨™æº–ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¦ãŠã„ã¦ã€ã‚¹ã‚­ãƒ¼ãƒãƒ™ãƒ¼ã‚¹ã§å€¤åŸŸã‚„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">my_table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* check expression */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TO_JSON_STRING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ValidationError&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;checks failed&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="not-null"></a>NOT NULL<a class="hash-link" href="#not-null" title="Direct link to heading">#</a></h3><p>column ãŒ NULL ã§ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚BigQuery ã® REQUIRED ã§æ¸ˆã‚ã°ã„ã„ã®ã§ã™ãŒã€ãŠå®¢æ§˜ã‹ã‚‰ã„ãŸã ããƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæºã‚ŒãŸæ™‚ã«å¯¾å‡¦ã§ããªã„ãŸã‚ã€NULLABLE ã§å–ã‚Šè¾¼ã‚“ã§ã“ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">my_table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* column */</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TO_JSON_STRING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ValidationError&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;checks failed&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="unique"></a>UNIQUE<a class="hash-link" href="#unique" title="Direct link to heading">#</a></h3><p>column1, column2 ãŒãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ãƒ¦ãƒ‹ãƒ¼ã‚¯ä¿è¨¼ãŒã§ããªã„ã®ã§ã€æ™‚æŠ˜ç¢ºèªã—ã¦ãŠã‹ãªã„ã¨ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã ã¨æ€ã„è¾¼ã‚“ã§ã„ã‚‹ã‚‚ã®ã® JOIN ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¤§ãããªã£ã¦å–ã‚Šè¿”ã—ã®ã¤ã‹ãªã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">my_table</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* column1 */</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* column2 */</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* column1 */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* column2 */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">HAVING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TO_JSON_STRING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ValidationError&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;checks failed&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="foreign-key"></a>FOREIGN KEY<a class="hash-link" href="#foreign-key" title="Direct link to heading">#</a></h3><p>my_table1.key1, key2 ãŒ my_table2.key1, key2 ã‚’å…¨ã¦å«æœ‰ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒã¤ã„ã¦ãŠã‚‰ãšã€æ‰‹å‹•é‹ç”¨ã®æœ«ã«ä¸æ•´åˆãŒèµ·ãã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚‚è¦‹ã‹ã‘ã¾ã™ã€‚ãã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒå¿…è¦ãªæ™‚ã¯ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã§ç¢ºèªã—ã€å¿…é ˆã§ãªã„ãªã‚‰ä¸æ•´åˆå‰²åˆã‚’è¦‹ã¦å•é¡Œã®å¤§ãã•ã«ã‚ˆã£ã¦ç„¡è¦–ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sql codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">my_table1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_dataset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">my_table2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_table1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">key1</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">my_table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">key1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> my_table1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">key2</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">my_table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">key2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        my_table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> my_table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">key2 </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TO_JSON_STRING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">STRUCT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ValidationError&#x27;</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;checks failed&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒ"></a>è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒ<a class="hash-link" href="#è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒ" title="Direct link to heading">#</a></h2><p>åˆ¶ç´„ã ã‘ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®è³ªãŒå¤‰ã‚ã£ãŸã“ã¨ã‚’æ¤œçŸ¥ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã«ã€ç¤¾å†…ã§ã¯è¦ç´„çµ±è¨ˆé‡ã‚’ç®—å‡ºã—ã¦ã„ã¾ã™ã€‚è¶…å·¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã‚‚è¦ç´„çµ±è¨ˆé‡ã‚’ä¸€åº¦è¨ˆç®—ã—ã¦ãŠã‘ã°ã€æ¯”è¼ƒã®ã‚³ã‚¹ãƒˆãŒå°ã•ã„ç‚¹ã‚‚é­…åŠ›ã§ã™ã€‚æ‰‹å‹•ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹å ´åˆã«ã¯ã€ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã«å·®ç•°ãŒãªã„ã‹ã€ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã«å¤§ããªãšã‚ŒãŒãªã„ã‹ã‚’ç›®è¦–ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tensorflow-data-validation"></a>Tensorflow Data Validation<a class="hash-link" href="#tensorflow-data-validation" title="Direct link to heading">#</a></h3><p>Tensorflow Data Validation ã¯ visualize_statistics ã§ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã€validate_statistics ã«ã¦ãƒ‡ãƒ¼ã‚¿ã®åŒå®šã‚’è¡Œã£ã¦ãã‚Œã¾ã™ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pandas-profiling"></a>pandas-profiling<a class="hash-link" href="#pandas-profiling" title="Direct link to heading">#</a></h3><p>pandas-profiling ã¯ã‚‚ã†å°‘ã—å°ã•ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå‘ãã§ã€ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã‚’è¡Œã£ã¦ãã‚Œã¾ã™ã€‚å°ã•ãã¦åˆã‚ã¾ã—ã¦ã®ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã¯ã“ã‚ŒãŒãŠæ‰‹è»½ã§ã™ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="bq_profile"></a>bq_profile<a class="hash-link" href="#bq_profile" title="Direct link to heading">#</a></h3><p><a href="https://qiita.com/rhoboro/items/c61e81246f87d346e656" target="_blank" rel="noopener noreferrer">bq_profile</a> ã¯åŒåƒšã® rhoboro æ°ã«ä½œã£ã¦ã„ãŸã ã„ãŸã€BigQuery ã§è¦ç´„çµ±è¨ˆé‡ã‚’è¦‹ãŸã„ã¨ãã«ä½¿ãˆã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
å¯è¦–åŒ–ã‚ˆã‚Šã‚‚ã€ç¶™ç¶šã—ã¦ã„ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã§ãƒ‡ãƒ¼ã‚¿å“è³ªã®åŠ£åŒ–ãŒãªã„ã‹ç¢ºã‹ã‚ã‚‹ã®ã«é‡ãã‚’ãŠã„ã¦ä½œã£ã¦ï¼ˆã„ã‚‹ã¨èªè­˜ã—ã¦ï¼‰ãŠã‚Šã€å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«å¯¾ã—ã¦ã‚‚é«˜é€Ÿã«å‹•ä½œã™ã‚‹ãŸã‚å¤šç”¨ã—ã¦ã„ã¾ã™ã€‚</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ãŠã‚ã‚Šã«"></a>ãŠã‚ã‚Šã«<a class="hash-link" href="#ãŠã‚ã‚Šã«" title="Direct link to heading">#</a></h1><p>è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒã¯ãƒ„ãƒ¼ãƒ«ç´¹ä»‹ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ç¤¾å†…ã§ã¯ BigQuery ã‚’ã„ã‹ã«é‹ç”¨å“è³ªã§ä½¿ã£ã¦ã„ãã‹ã‚’æ¤œè¨ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã«ã€ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãŒé–“é•ã£ã¦ã„ãªã„ã“ã¨ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿å“è³ªã«åŠ£åŒ–ãŒãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ä»•çµ„ã¿ã¨ã—ã¦ä¸Šè¨˜ã®ã‚ˆã†ãªä»•çµ„ã¿ã‚’è©¦ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã—è‰¯ã„ã‚„ã‚Šæ–¹ã‚’ã”å­˜çŸ¥ã§ã‚ã‚Œã°ã€ãœã²æ•™ãˆã¦ãã ã•ã„ã€‚</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/bigquery">bigquery</a></div></footer></article><div><a href="https://github.com/na0fu3y/queuery/edit/master/blog/2020-01-21-sql-test-and-data-check.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/01/21/new-bigquery"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« BigQuery æƒ…å ±åé›†</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’-function-ã‹-with-å¥ã«åˆ†é›¢ã™ã‚‹ã€‚" class="table-of-contents__link">æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’ FUNCTION ã‹ WITH å¥ã«åˆ†é›¢ã™ã‚‹ã€‚</a><ul><li><a href="#birth_date_percentile_5" class="table-of-contents__link">birth_date_percentile_5</a></li><li><a href="#user_master" class="table-of-contents__link">user_master</a></li><li><a href="#pos" class="table-of-contents__link">pos</a></li><li><a href="#rfm_feature" class="table-of-contents__link">rfm_feature</a></li><li><a href="#concatinated_features" class="table-of-contents__link">concatinated_features</a></li></ul></li><li><a href="#å¯å¤‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã€sql-ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚" class="table-of-contents__link">å¯å¤‰ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã«ç½®ãæ›ãˆã€SQL ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã€‚</a><ul><li><a href="#birth_date_percentile_5-1" class="table-of-contents__link">birth_date_percentile_5</a></li><li><a href="#user_master-1" class="table-of-contents__link">user_master</a></li><li><a href="#pos-1" class="table-of-contents__link">pos</a></li><li><a href="#rfm_feature-1" class="table-of-contents__link">rfm_feature</a></li><li><a href="#concatinated_features-1" class="table-of-contents__link">concatinated_features</a></li></ul></li><li><a href="#ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚" class="table-of-contents__link">ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚</a><ul><li><a href="#dirty_user_master" class="table-of-contents__link">dirty_user_master</a></li><li><a href="#user_master-3" class="table-of-contents__link">user_master</a></li><li><a href="#dirty_pos" class="table-of-contents__link">dirty_pos</a></li><li><a href="#dirty_pos-1" class="table-of-contents__link">dirty_pos</a></li></ul></li><li><a href="#rfm_feature-2" class="table-of-contents__link">rfm_feature</a></li><li><a href="#sql-ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’-function-ã‹-with-å¥ã¨ã—ã¦çµåˆã™ã‚‹ã€‚" class="table-of-contents__link">SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã®å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ FUNCTION ã‹ WITH å¥ã¨ã—ã¦çµåˆã™ã‚‹ã€‚</a></li><li><a href="#ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›æ™‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚" class="table-of-contents__link">ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›æ™‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨å‡ºåŠ›ãŒè¿”ã£ã¦ãã‚‹ã‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚</a></li><li><a href="#ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„" class="table-of-contents__link">ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„</a><ul><li><a href="#check" class="table-of-contents__link">CHECK</a></li><li><a href="#not-null" class="table-of-contents__link">NOT NULL</a></li><li><a href="#unique" class="table-of-contents__link">UNIQUE</a></li><li><a href="#foreign-key" class="table-of-contents__link">FOREIGN KEY</a></li></ul></li><li><a href="#è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒ" class="table-of-contents__link">è¦ç´„çµ±è¨ˆé‡ã®æ¯”è¼ƒ</a><ul><li><a href="#tensorflow-data-validation" class="table-of-contents__link">Tensorflow Data Validation</a></li><li><a href="#pandas-profiling" class="table-of-contents__link">pandas-profiling</a></li><li><a href="#bq_profile" class="table-of-contents__link">bq_profile</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/data-management">ãƒ‡ãƒ¼ã‚¿ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã¨ã¯</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/bigquery-access-controls">BigQuery ã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®š</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/na0fu3y" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/na0fu3y" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://qiita.com/na0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Qiita</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Queuery. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.5c08f17d.js"></script>
<script src="/runtime~main.54d8ed7a.js"></script>
<script src="/main.8cc151df.js"></script>
<script src="/1.72e98765.js"></script>
<script src="/2.7889eed3.js"></script>
<script src="/3.41c7bdcc.js"></script>
<script src="/ccc49370.a83013a9.js"></script>
<script src="/9c0a0ea5.583a3e0c.js"></script>
<script src="/2e70a6ea.ccdcd855.js"></script>
</body>
</html>